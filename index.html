<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
    <div>
        <p id="MarketStatus">Market Close</p>
        <p id="StockFilter">Waiting To 9:25 AM</p>
        <p>Positive Stocks: <span id="positiveCount">0</span></p>
        <p>Negative Stocks: <span id="negativeCount">0</span></p>
        <p>Last updated: <span id="lastUpdated">--:--:--</span></p>
        <button id="sendMessage">Send Message</button>
        <button id="clearMessages">Clear Messages</button>
        <button id="getMessages">Get Messages</button>
    </div>
    <script>
const Access_Toke = 'eyJ0eXAiOiJKV1QiLCJrZXlfaWQiOiJza192MS4wIiwiYWxnIjoiSFMyNTYifQ.eyJzdWIiOiIzU0NWUDIiLCJqdGkiOiI2ODc5YjE2NGQ2YWFiODM5ZTVlZmE5NDUiLCJpc011bHRpQ2xpZW50IjpmYWxzZSwiaXNQbHVzUGxhbiI6ZmFsc2UsImlhdCI6MTc1MjgwNTczMiwiaXNzIjoidWRhcGktZ2F0ZXdheS1zZXJ2aWNlIiwiZXhwIjoxNzUyODc2MDAwfQ.efi5O0nwa7lKLK4R0EhmcnMv7lHYxCL_DAXySghxNsc';
const BOT_TOKEN = '8059186996:AAFE2nk2g6jHH5ZGDXA77HR0NSjZsi3sNG4';
const CHAT_ID = '898200274';
const MyRiskPerTrade=100;

const nifty50StocksList = [
  ["NSE_EQ|INE466L01038", "360ONE", "360 ONE WAM"],
  ["NSE_EQ|INE769A01020", "AARTIIND", "Aarti Industries"],
  ["NSE_EQ|INE117A01022", "ABB", "ABB India"],
  ["NSE_EQ|INE674K01013", "ABCAPITAL", "Aditya Birla Capital"],
  ["NSE_EQ|INE647O01011", "ABFRL", "Aditya Birla Fashion and Retail"],
  ["NSE_EQ|INE012A01025", "ACC", "ACC"],
  ["NSE_EQ|INE931S01010", "ADANIENSOL", "Adani Energy Solutions"],
  ["NSE_EQ|INE423A01024", "ADANIENT", "Adani Enterprises"],
  ["NSE_EQ|INE364U01010", "ADANIGREEN", "Adani Green Energy"],
  ["NSE_EQ|INE742F01042", "ADANIPORTS", "Adani Ports and Special Economic Zone"],
  ["NSE_EQ|INE540L01014", "ALKEM", "Alkem Laboratories"],
  ["NSE_EQ|INE371P01015", "AMBER", "Amber Enterprises India"],
  ["NSE_EQ|INE079A01024", "AMBUJACEM", "Ambuja Cements"],
  ["NSE_EQ|INE732I01013", "ANGELONE", "Angel One"],
  ["NSE_EQ|INE702C01027","APLAPOLLO",  "APL Apollo Tubes" ],
  ["NSE_EQ|INE437A01024","APOLLOHOSP",  "Apollo Hospitals Enterprise" ],
  ["NSE_EQ|INE208A01029","ASHOKLEY",  "Ashok Leyland" ],
  ["NSE_EQ|INE021A01026","ASIANPAINT",  "Asian Paints" ],
  ["NSE_EQ|INE006I01046","ASTRAL",  "Astral" ],
  ["NSE_EQ|INE399L01023","ATGL",  "Adani Total Gas" ],
  ["NSE_EQ|INE949L01017","AUBANK",  "AU Small Finance Bank" ],
  ["NSE_EQ|INE406A01037","AUROPHARMA",  "Aurobindo Pharma" ],
  ["NSE_EQ|INE238A01034","AXISBANK",  "Axis Bank" ],
  ["NSE_EQ|INE917I01010","BAJAJ-AUTO",  "Bajaj Auto" ],
  ["NSE_EQ|INE918I01026","BAJAJFINSV",  "Bajaj Finserv" ],
  ["NSE_EQ|INE296A01032","BAJFINANCE",  "Bajaj Finance" ],
  ["NSE_EQ|INE787D01026","BALKRISIND",  "Balkrishna Industries" ],
  ["NSE_EQ|INE545U01014","BANDHANBNK",  "Bandhan Bank" ],
  ["NSE_EQ|INE028A01039","BANKBARODA",  "Bank of Baroda" ],
  ["NSE_EQ|INE084A01016","BANKINDIA",  "Bank of India" ],
  ["NSE_EQ|INE171Z01026","BDL",  "Bharat Dynamics" ],
  ["NSE_EQ|INE263A01024","BEL",  "Bharat Electronics" ],
  ["NSE_EQ|INE465A01025","BHARATFORG",  "Bharat Forge" ],
  ["NSE_EQ|INE397D01024","BHARTIARTL",  "Bharti Airtel" ],
  ["NSE_EQ|INE257A01026","BHEL",  "Bharat Heavy Electricals" ],
  ["NSE_EQ|INE376G01013","BIOCON",  "Biocon" ],
  ["NSE_EQ|INE472A01039","BLUESTARCO",  "Blue Star" ],
  ["NSE_EQ|INE323A01026","BOSCHLTD",  "Bosch" ],
  ["NSE_EQ|INE029A01011","BPCL",  "Bharat Petroleum Corporation" ],
  ["NSE_EQ|INE216A01030","BRITANNIA",  "Britannia Industries" ],
  ["NSE_EQ|INE118H01025","BSE",  "BSE" ],
  ["NSE_EQ|INE836A01035","BSOFT",  "BIRLASOFT" ],
  ["NSE_EQ|INE596I01012","CAMS",  "Computer Age Management Services" ],
  ["NSE_EQ|INE476A01022","CANBK",  "Canara Bank" ],
  ["NSE_EQ|INE736A01011","CDSL",  "Central Depository Services (India)" ],
  ["NSE_EQ|INE486A01021","CESC",  "CESC" ],
  ["NSE_EQ|INE067A01029","CGPOWER",  "CG Power and Industrial Solutions" ],
  ["NSE_EQ|INE085A01013","CHAMBLFERT",  "Chambal Fertilizers & Chemicals" ],
  ["NSE_EQ|INE121A01024","CHOLAFIN",  "Cholamandalam Investment and Finance Company" ],
  ["NSE_EQ|INE059A01026","CIPLA",  "Cipla" ],
  ["NSE_EQ|INE522F01014","COALINDIA",  "Coal India" ],
  ["NSE_EQ|INE591G01025","COFORGE",  "Coforge" ],
  ["NSE_EQ|INE259A01022","COLPAL",  "Colgate Palmolive (India)" ],
  ["NSE_EQ|INE111A01025","CONCOR",  "Container Corporation of India" ],
  ["NSE_EQ|INE299U01018","CROMPTON",  "Crompton Greaves Consumer Electricals" ],
  ["NSE_EQ|INE298A01020","CUMMINSIND",  "Cummins India" ],
  ["NSE_EQ|INE136B01020","CYIENT",  "Cyient" ],
  ["NSE_EQ|INE016A01026","DABUR",  "Dabur India" ],
  ["NSE_EQ|INE00R701025","DALBHARAT",  "Dalmia Bharat" ],
  ["NSE_EQ|INE148O01028","DELHIVERY",  "Delhivery" ],
  ["NSE_EQ|INE361B01024","DIVISLAB",  "Divi's Laboratories" ],
  ["NSE_EQ|INE935N01020","DIXON",  "Dixon Technologies (India)" ],
  ["NSE_EQ|INE271C01023","DLF",  "DLF" ],
  ["NSE_EQ|INE192R01011","DMART",  "Avenue Supermarts" ],
  ["NSE_EQ|INE089A01031","DRREDDY",  "Dr. Reddy's Laboratories" ],
  ["NSE_EQ|INE066A01021","EICHERMOT",  "Eicher Motors" ],
  ["NSE_EQ|INE758T01015","ETERNAL",  "ETERNAL" ],
  ["NSE_EQ|INE302A01020","EXIDEIND",  "Exide Industries" ],
  ["NSE_EQ|INE171A01029","FEDERALBNK",  "The Federal Bank" ],
  ["NSE_EQ|INE061F01013","FORTIS",  "Fortis Healthcare" ],
  ["NSE_EQ|INE129A01019","GAIL",  "GAIL (India)" ],
  ["NSE_EQ|INE935A01035","GLENMARK",  "Glenmark Pharmaceuticals" ],
  ["NSE_EQ|INE776C01039","GMRAIRPORT",  "GMR AIRPORTS" ],
  ["NSE_EQ|INE102D01028","GODREJCP",  "Godrej Consumer Products" ],
  ["NSE_EQ|INE484J01027","GODREJPROP",  "Godrej Properties" ],
  ["NSE_EQ|INE101D01020","GRANULES",  "Granules India" ],
  ["NSE_EQ|INE047A01021","GRASIM",  "Grasim Industries" ],
  ["NSE_EQ|INE066F01020","HAL",  "Hindustan Aeronautics" ],
  ["NSE_EQ|INE176B01034","HAVELLS",  "Havells India" ],
  ["NSE_EQ|INE860A01027","HCLTECH",  "HCL Technologies" ],
  ["NSE_EQ|INE127D01025","HDFCAMC",  "HDFC Asset Management Company" ],
  ["NSE_EQ|INE040A01034","HDFCBANK",  "HDFC Bank" ],
  ["NSE_EQ|INE795G01014","HDFCLIFE",  "HDFC Life Insurance Company" ],
  ["NSE_EQ|INE158A01026","HEROMOTOCO",  "Hero MotoCorp" ],
  ["NSE_EQ|INE548A01028","HFCL",  "HFCL" ],
  ["NSE_EQ|INE038A01020","HINDALCO",  "Hindalco Industries" ],
  ["NSE_EQ|INE531E01026","HINDCOPPER",  "Hindustan Copper" ],
  ["NSE_EQ|INE094A01015","HINDPETRO",  "Hindustan Petroleum Corporation" ],
  ["NSE_EQ|INE030A01027","HINDUNILVR",  "Hindustan Unilever" ],
  ["NSE_EQ|INE267A01025","HINDZINC",  "Hindustan Zinc" ],
  ["NSE_EQ|INE031A01017","HUDCO",  "Housing & Urban Development Corporation" ],
  ["NSE_EQ|INE090A01021","ICICIBANK",  "ICICI Bank" ],
  ["NSE_EQ|INE765G01017","ICICIGI",  "ICICI Lombard General Insurance Company" ],
  ["NSE_EQ|INE726G01019","ICICIPRULI",  "ICICI Prudential Life Insurance Company" ],
  ["NSE_EQ|INE669E01016","IDEA",  "Vodafone Idea" ],
  ["NSE_EQ|INE092T01019","IDFCFIRSTB",  "IDFC First Bank" ],
  ["NSE_EQ|INE022Q01020","IEX",  "Indian Energy Exchange" ],
  ["NSE_EQ|INE203G01027","IGL",  "Indraprastha Gas" ],
  ["NSE_EQ|INE530B01024","IIFL",  "IIFL Finance" ],
  ["NSE_EQ|INE053A01029","INDHOTEL",  "The Indian Hotels Company" ],
  ["NSE_EQ|INE562A01011","INDIANB",  "Indian Bank" ],
  ["NSE_EQ|INE646L01027","INDIGO",  "InterGlobe Aviation" ],
  ["NSE_EQ|INE095A01012","INDUSINDBK",  "IndusInd Bank" ],
  ["NSE_EQ|INE121J01017","INDUSTOWER",  "Indus Towers" ],
  ["NSE_EQ|INE009A01021","INFY",  "Infosys" ],
  ["NSE_EQ|INE066P01011","INOXWIND",  "Inox Wind" ],
  ["NSE_EQ|INE242A01010","IOC",  "Indian Oil Corporation" ],
  ["NSE_EQ|INE821I01022","IRB",  "IRB Infrastructure Developers" ],
  ["NSE_EQ|INE335Y01020","IRCTC",  "Indian Railway Catering And Tourism Corporation" ],
  ["NSE_EQ|INE202E01016","IREDA",  "Indian Renewable Energy Development Agency" ],
  ["NSE_EQ|INE053F01010","IRFC",  "Indian Railway Finance Corporation" ],
  ["NSE_EQ|INE154A01025","ITC",  "ITC" ],
  ["NSE_EQ|INE749A01030","JINDALSTEL",  "Jindal Steel & Power" ],
  ["NSE_EQ|INE758E01017","JIOFIN",  "Jio Financial Services" ],
  ["NSE_EQ|INE220G01021","JSL",  "Jindal Stainless" ],
  ["NSE_EQ|INE121E01018","JSWENERGY",  "JSW Energy" ],
  ["NSE_EQ|INE019A01038","JSWSTEEL",  "JSW Steel" ],
  ["NSE_EQ|INE797F01020","JUBLFOOD",  "Jubilant Foodworks" ],
  ["NSE_EQ|INE303R01014","KALYANKJIL",  "Kalyan Jewellers India" ],
  ["NSE_EQ|INE918Z01012","KAYNES",  "Kaynes Technology India" ],
  ["NSE_EQ|INE878B01027","KEI",  "KEI Industries" ],
  ["NSE_EQ|INE138Y01010","KFINTECH",  "Kfin Technologies" ],
  ["NSE_EQ|INE237A01028","KOTAKBANK",  "Kotak Mahindra Bank" ],
  ["NSE_EQ|INE04I401011","KPITTECH",  "KPIT Technologies" ],
  ["NSE_EQ|INE947Q01028","LAURUSLABS",  "Laurus Labs" ],
  ["NSE_EQ|INE115A01026","LICHSGFIN",  "LIC Housing Finance" ],
  ["NSE_EQ|INE0J1Y01017","LICI",  "Life Insurance Corporation Of India" ],
  ["NSE_EQ|INE670K01029","LODHA",  "Macrotech Developers" ],
  ["NSE_EQ|INE018A01030","LT",  "Larsen & Toubro" ],
  ["NSE_EQ|INE498L01015","LTF",  "L&T Finance" ],
  ["NSE_EQ|INE214T01019","LTIM",  "LTIMindtree" ],
  ["NSE_EQ|INE326A01037","LUPIN",  "Lupin" ],
  ["NSE_EQ|INE101A01026","M&M",  "Mahindra & Mahindra" ],
  ["NSE_EQ|INE774D01024","M&MFIN",  "Mahindra & Mahindra Financial Services" ],
  ["NSE_EQ|INE522D01027","MANAPPURAM",  "Manappuram Finance" ],
  ["NSE_EQ|INE634S01028","MANKIND",  "Mankind Pharma" ],
  ["NSE_EQ|INE196A01026","MARICO",  "Marico" ],
  ["NSE_EQ|INE585B01010","MARUTI",  "Maruti Suzuki India" ],
  ["NSE_EQ|INE027H01010","MAXHEALTH",  "Max Healthcare Institute" ],
  ["NSE_EQ|INE249Z01020","MAZDOCK",  "Mazagon Dock Shipbuilders" ],
  ["NSE_EQ|INE745G01035","MCX",  "Multi Commodity Exchange of India" ],
  ["NSE_EQ|INE180A01020","MFSL",  "Max Financial Services" ],
  ["NSE_EQ|INE002S01010","MGL",  "Mahanagar Gas" ],
  ["NSE_EQ|INE775A01035","MOTHERSON",  "Samvardhana Motherson International" ],
  ["NSE_EQ|INE356A01018","MPHASIS",  "MphasiS" ],
  ["NSE_EQ|INE414G01012","MUTHOOTFIN",  "Muthoot Finance" ],
  ["NSE_EQ|INE139A01034","NATIONALUM",  "National Aluminium Company" ],
  ["NSE_EQ|INE663F01032","NAUKRI",  "Info Edge (India)" ],
  ["NSE_EQ|INE095N01031","NBCC",  "NBCC (India)" ],
  ["NSE_EQ|INE868B01028","NCC",  "NCC" ],
  ["NSE_EQ|INE239A01024","NESTLEIND",  "Nestle India" ],
  ["NSE_EQ|INE848E01016","NHPC",  "NHPC" ],
  ["NSE_EQ|INE584A01023","NMDC",  "NMDC" ],
  ["NSE_EQ|INE733E01010","NTPC",  "NTPC" ],
  ["NSE_EQ|INE388Y01029","NYKAA",  "FSN E-Commerce Ventures" ],
  ["NSE_EQ|INE093I01010","OBEROIRLTY",  "Oberoi Realty" ],
  ["NSE_EQ|INE881D01027","OFSS",  "Oracle Financial Services Software" ],
  ["NSE_EQ|INE274J01014","OIL",  "Oil India" ],
  ["NSE_EQ|INE213A01029","ONGC",  "Oil & Natural Gas Corporation" ],
  ["NSE_EQ|INE761H01022","PAGEIND",  "Page Industries" ],
  ["NSE_EQ|INE619A01035","PATANJALI",  "Patanjali Foods" ],
  ["NSE_EQ|INE982J01020","PAYTM",  "One 97 Communications" ],
  ["NSE_EQ|INE140A01024","PEL",  "Piramal Enterprises" ],
  ["NSE_EQ|INE262H01021","PERSISTENT",  "Persistent Systems" ],
  ["NSE_EQ|INE347G01014","PETRONET",  "Petronet LNG" ],
  ["NSE_EQ|INE134E01011","PFC",  "Power Finance Corporation" ],
  ["NSE_EQ|INE457L01029","PGEL",  "PG Electroplast" ],
  ["NSE_EQ|INE211B01039","PHOENIXLTD",  "The Phoenix Mills" ],
  ["NSE_EQ|INE318A01026","PIDILITIND",  "Pidilite Industries" ],
  ["NSE_EQ|INE603J01030","PIIND",  "PI Industries" ],
  ["NSE_EQ|INE160A01022","PNB",  "Punjab National Bank" ],
  ["NSE_EQ|INE572E01012","PNBHOUSING",  "PNB Housing Finance" ],
  ["NSE_EQ|INE417T01026","POLICYBZR",  "PB Fintech" ],
  ["NSE_EQ|INE455K01017","POLYCAB",  "Polycab India" ],
  ["NSE_EQ|INE511C01022","POONAWALLA",  "Poonawalla Fincorp" ],
  ["NSE_EQ|INE752E01010","POWERGRID",  "Power Grid Corporation of India" ],
  ["NSE_EQ|INE0DK501011","PPLPHARMA",  "Piramal Pharma" ],
  ["NSE_EQ|INE811K01011","PRESTIGE",  "Prestige Estates Projects" ],
  ["NSE_EQ|INE976G01028","RBLBANK",  "RBL Bank" ],
  ["NSE_EQ|INE020B01018","RECLTD",  "REC" ],
  ["NSE_EQ|INE002A01018","RELIANCE",  "Reliance Industries" ],
  ["NSE_EQ|INE415G01027","RVNL",  "Rail Vikas Nigam" ],
  ["NSE_EQ|INE114A01011","SAIL",  "Steel Authority of India" ],
  ["NSE_EQ|INE018E01016","SBICARD",  "SBI Cards and Payment Services" ],
  ["NSE_EQ|INE123W01016","SBILIFE",  "SBI Life Insurance Company" ],
  ["NSE_EQ|INE062A01020","SBIN",  "State Bank of India" ],
  ["NSE_EQ|INE070A01015","SHREECEM",  "SHREE CEMENT" ],
  ["NSE_EQ|INE721A01047","SHRIRAMFIN",  "Shriram Finance" ],
  ["NSE_EQ|INE003A01024","SIEMENS",  "Siemens" ],
  ["NSE_EQ|INE002L01015","SJVN",  "SJVN" ],
  ["NSE_EQ|INE343H01029","SOLARINDS",  "Solar Industries India" ],
  ["NSE_EQ|INE073K01018","SONACOMS",  "Sona BLW Precision Forgings" ],
  ["NSE_EQ|INE647A01010","SRF",  "SRF" ],
  ["NSE_EQ|INE044A01036","SUNPHARMA",  "Sun Pharmaceutical Industries" ],
  ["NSE_EQ|INE195A01028","SUPREMEIND",  "Supreme Industries" ],
  ["NSE_EQ|INE398R01022","SYNGENE",  "Syngene International" ],
  ["NSE_EQ|INE092A01019","TATACHEM",  "Tata Chemicals" ],
  ["NSE_EQ|INE151A01013","TATACOMM",  "Tata Communications" ],
  ["NSE_EQ|INE192A01025","TATACONSUM",  "TATA CONSUMER PRODUCTS" ],
  ["NSE_EQ|INE670A01012","TATAELXSI",  "Tata Elxsi" ],
  ["NSE_EQ|INE155A01022","TATAMOTORS",  "Tata Motors" ],
  ["NSE_EQ|INE245A01021","TATAPOWER",  "Tata Power Company" ],
  ["NSE_EQ|INE081A01020","TATASTEEL",  "Tata Steel" ],
  ["NSE_EQ|INE142M01025","TATATECH",  "Tata Technologies" ],
  ["NSE_EQ|INE467B01029","TCS",  "Tata Consultancy Services" ],
  ["NSE_EQ|INE669C01036","TECHM",  "Tech Mahindra" ],
  ["NSE_EQ|INE974X01010","TIINDIA",  "Tube Investments of India" ],
  ["NSE_EQ|INE615H01020","TITAGARH",  "TITAGARH RAIL SYSTEMS" ],
  ["NSE_EQ|INE280A01028","TITAN",  "Titan Company" ],
  ["NSE_EQ|INE685A01028","TORNTPHARM",  "Torrent Pharmaceuticals" ],
  ["NSE_EQ|INE813H01021","TORNTPOWER",  "Torrent Power" ],
  ["NSE_EQ|INE849A01020","TRENT",  "Trent" ],
  ["NSE_EQ|INE494B01023","TVSMOTOR",  "TVS Motor Company" ],
  ["NSE_EQ|INE481G01011","ULTRACEMCO",  "UltraTech Cement" ],
  ["NSE_EQ|INE692A01016","UNIONBANK",  "Union Bank of India" ],
  ["NSE_EQ|INE854D01024","UNITDSPR",  "United Spirits" ],
  ["NSE_EQ|INE405E01023","UNOMINDA",  "UNO Minda" ],
  ["NSE_EQ|INE628A01036","UPL",  "UPL" ],
  ["NSE_EQ|INE200M01039","VBL",  "Varun Beverages" ],
  ["NSE_EQ|INE205A01025","VEDL",  "Vedanta" ],
  ["NSE_EQ|INE226A01021","VOLTAS",  "Voltas" ],
  ["NSE_EQ|INE075A01022", "WIPRO", "Wipro"],
  ["NSE_EQ|INE528G01035", "YESBANK", "Yes Bank"],
  ["NSE_EQ|INE010B01027", "ZYDUSLIFE", "Zydus Lifesciences"]
];



var LTPQuotesStockList = `
NSE_EQ|INE466L01038,
NSE_EQ|INE769A01020,
NSE_EQ|INE117A01022,
NSE_EQ|INE674K01013,
NSE_EQ|INE647O01011,
NSE_EQ|INE012A01025,
NSE_EQ|INE931S01010,
NSE_EQ|INE423A01024,
NSE_EQ|INE364U01010,
NSE_EQ|INE742F01042,
NSE_EQ|INE540L01014,
NSE_EQ|INE371P01015,
NSE_EQ|INE079A01024,
NSE_EQ|INE732I01013,
NSE_EQ|INE702C01027,
NSE_EQ|INE437A01024,
NSE_EQ|INE208A01029,
NSE_EQ|INE021A01026,
NSE_EQ|INE006I01046,
NSE_EQ|INE399L01023,
NSE_EQ|INE949L01017,
NSE_EQ|INE406A01037,
NSE_EQ|INE238A01034,
NSE_EQ|INE917I01010,
NSE_EQ|INE918I01026,
NSE_EQ|INE296A01032,
NSE_EQ|INE787D01026,
NSE_EQ|INE545U01014,
NSE_EQ|INE028A01039,
NSE_EQ|INE084A01016,
NSE_EQ|INE171Z01026,
NSE_EQ|INE263A01024,
NSE_EQ|INE465A01025,
NSE_EQ|INE397D01024,
NSE_EQ|INE257A01026,
NSE_EQ|INE376G01013,
NSE_EQ|INE472A01039,
NSE_EQ|INE323A01026,
NSE_EQ|INE029A01011,
NSE_EQ|INE216A01030,
NSE_EQ|INE118H01025,
NSE_EQ|INE836A01035,
NSE_EQ|INE596I01012,
NSE_EQ|INE476A01022,
NSE_EQ|INE736A01011,
NSE_EQ|INE486A01021,
NSE_EQ|INE067A01029,
NSE_EQ|INE085A01013,
NSE_EQ|INE121A01024,
NSE_EQ|INE059A01026,
NSE_EQ|INE522F01014,
NSE_EQ|INE591G01025,
NSE_EQ|INE259A01022,
NSE_EQ|INE111A01025,
NSE_EQ|INE299U01018,
NSE_EQ|INE298A01020,
NSE_EQ|INE136B01020,
NSE_EQ|INE016A01026,
NSE_EQ|INE00R701025,
NSE_EQ|INE148O01028,
NSE_EQ|INE361B01024,
NSE_EQ|INE935N01020,
NSE_EQ|INE271C01023,
NSE_EQ|INE192R01011,
NSE_EQ|INE089A01031,
NSE_EQ|INE066A01021,
NSE_EQ|INE758T01015,
NSE_EQ|INE302A01020,
NSE_EQ|INE171A01029,
NSE_EQ|INE061F01013,
NSE_EQ|INE129A01019,
NSE_EQ|INE935A01035,
NSE_EQ|INE776C01039,
NSE_EQ|INE102D01028,
NSE_EQ|INE484J01027,
NSE_EQ|INE101D01020,
NSE_EQ|INE047A01021,
NSE_EQ|INE066F01020,
NSE_EQ|INE176B01034,
NSE_EQ|INE860A01027,
NSE_EQ|INE127D01025,
NSE_EQ|INE040A01034,
NSE_EQ|INE795G01014,
NSE_EQ|INE158A01026,
NSE_EQ|INE548A01028,
NSE_EQ|INE038A01020,
NSE_EQ|INE531E01026,
NSE_EQ|INE094A01015,
NSE_EQ|INE030A01027,
NSE_EQ|INE267A01025,
NSE_EQ|INE031A01017,
NSE_EQ|INE090A01021,
NSE_EQ|INE765G01017,
NSE_EQ|INE726G01019,
NSE_EQ|INE669E01016,
NSE_EQ|INE092T01019,
NSE_EQ|INE022Q01020,
NSE_EQ|INE203G01027,
NSE_EQ|INE530B01024,
NSE_EQ|INE053A01029,
NSE_EQ|INE562A01011,
NSE_EQ|INE646L01027,
NSE_EQ|INE095A01012,
NSE_EQ|INE121J01017,
NSE_EQ|INE009A01021,
NSE_EQ|INE066P01011,
NSE_EQ|INE242A01010,
NSE_EQ|INE821I01022,
NSE_EQ|INE335Y01020,
NSE_EQ|INE202E01016,
NSE_EQ|INE053F01010,
NSE_EQ|INE154A01025,
NSE_EQ|INE749A01030,
NSE_EQ|INE758E01017,
NSE_EQ|INE220G01021,
NSE_EQ|INE121E01018,
NSE_EQ|INE019A01038,
NSE_EQ|INE797F01020,
NSE_EQ|INE303R01014,
NSE_EQ|INE918Z01012,
NSE_EQ|INE878B01027,
NSE_EQ|INE138Y01010,
NSE_EQ|INE237A01028,
NSE_EQ|INE04I401011,
NSE_EQ|INE947Q01028,
NSE_EQ|INE115A01026,
NSE_EQ|INE0J1Y01017,
NSE_EQ|INE670K01029,
NSE_EQ|INE018A01030,
NSE_EQ|INE498L01015,
NSE_EQ|INE214T01019,
NSE_EQ|INE326A01037,
NSE_EQ|INE101A01026,
NSE_EQ|INE774D01024,
NSE_EQ|INE522D01027,
NSE_EQ|INE634S01028,
NSE_EQ|INE196A01026,
NSE_EQ|INE585B01010,
NSE_EQ|INE027H01010,
NSE_EQ|INE249Z01020,
NSE_EQ|INE745G01035,
NSE_EQ|INE180A01020,
NSE_EQ|INE002S01010,
NSE_EQ|INE775A01035,
NSE_EQ|INE356A01018,
NSE_EQ|INE414G01012,
NSE_EQ|INE139A01034,
NSE_EQ|INE663F01032,
NSE_EQ|INE095N01031,
NSE_EQ|INE868B01028,
NSE_EQ|INE239A01024,
NSE_EQ|INE848E01016,
NSE_EQ|INE584A01023,
NSE_EQ|INE733E01010,
NSE_EQ|INE388Y01029,
NSE_EQ|INE093I01010,
NSE_EQ|INE881D01027,
NSE_EQ|INE274J01014,
NSE_EQ|INE213A01029,
NSE_EQ|INE761H01022,
NSE_EQ|INE619A01035,
NSE_EQ|INE982J01020,
NSE_EQ|INE140A01024,
NSE_EQ|INE262H01021,
NSE_EQ|INE347G01014,
NSE_EQ|INE134E01011,
NSE_EQ|INE457L01029,
NSE_EQ|INE211B01039,
NSE_EQ|INE318A01026,
NSE_EQ|INE603J01030,
NSE_EQ|INE160A01022,
NSE_EQ|INE572E01012,
NSE_EQ|INE417T01026,
NSE_EQ|INE455K01017,
NSE_EQ|INE511C01022,
NSE_EQ|INE752E01010,
NSE_EQ|INE0DK501011,
NSE_EQ|INE811K01011,
NSE_EQ|INE976G01028,
NSE_EQ|INE020B01018,
NSE_EQ|INE002A01018,
NSE_EQ|INE415G01027,
NSE_EQ|INE114A01011,
NSE_EQ|INE018E01016,
NSE_EQ|INE123W01016,
NSE_EQ|INE062A01020,
NSE_EQ|INE070A01015,
NSE_EQ|INE721A01047,
NSE_EQ|INE003A01024,
NSE_EQ|INE002L01015,
NSE_EQ|INE343H01029,
NSE_EQ|INE073K01018,
NSE_EQ|INE647A01010,
NSE_EQ|INE044A01036,
NSE_EQ|INE195A01028,
NSE_EQ|INE398R01022,
NSE_EQ|INE092A01019,
NSE_EQ|INE151A01013,
NSE_EQ|INE192A01025,
NSE_EQ|INE670A01012,
NSE_EQ|INE155A01022,
NSE_EQ|INE245A01021,
NSE_EQ|INE081A01020,
NSE_EQ|INE142M01025,
NSE_EQ|INE467B01029,
NSE_EQ|INE669C01036,
NSE_EQ|INE974X01010,
NSE_EQ|INE615H01020,
NSE_EQ|INE280A01028,
NSE_EQ|INE685A01028,
NSE_EQ|INE813H01021,
NSE_EQ|INE849A01020,
NSE_EQ|INE494B01023,
NSE_EQ|INE481G01011,
NSE_EQ|INE692A01016,
NSE_EQ|INE854D01024,
NSE_EQ|INE405E01023,
NSE_EQ|INE628A01036,
NSE_EQ|INE200M01039,
NSE_EQ|INE205A01025,
NSE_EQ|INE226A01021,
NSE_EQ|INE075A01022,
NSE_EQ|INE528G01035,
NSE_EQ|INE010B01027`











// ==============================================================================================
const tradingHours = new Date();
const hours = tradingHours.getHours(); 
if(hours >= 9 && hours < 14) {
    

let lastPositive = 0;
let lastNegative = 0;
const posiNegTime = [];
const headers = { Accept: 'application/json' };
var Index = 0;
const [time, open, high, low, close, volume] = [0, 1, 2, 3, 4, 5];
let messages = JSON.parse(localStorage.getItem('messages')) || [];

const fetchData = async () => {
    while (Index < nifty50StocksList.length) {
        // console.log(`index ${Index}Fetching data for stock: ${nifty50StocksList[Index][1]}`);
        document.getElementById("MarketStatus").innerText="Market is Open";
        const [neg, pos, tim] = posiNegTime;
        try {
            const URL = `https://api.upstox.com/v3/historical-candle/intraday/${nifty50StocksList[Index][0]}/minutes/5`;
            const response = await axios.get(URL, { headers });
            
            if (response.status == 200 && Index < nifty50StocksList.length && response.data.data.candles?.length >= 3) {
                const candles = response.data.data.candles;
                const [candle_0, candle_1, candle_2] = [candles[0], candles[1], candles[2]];
                const [date, Time, hours] = DateTime(candle_0[time]);
                document.getElementById("StockFilter").innerText="Stock Filtering in Progress";
                const DOWNcondition = (
                    candle_2[open] > candle_2[close] &&
                    candle_1[open] > candle_1[close] &&
                    candle_2[open] - candle_2[close] > (candle_1[open] - candle_1[close]) * 1.5 &&
                    candle_2[high] - candle_2[low] > (candle_1[high] - candle_1[low]) * 1.5 &&
                    candle_2[volume] * 2 < candle_1[volume] &&
                    candle_1[low] > candle_0[low] &&
                    (candle_1[high]- candle_1[low])*100 /candle_1[low] <0.6 &&
                    9<hours < 14 &&
                    neg > 140
                );
                const UPcondition = (
                    candle_2[open] < candle_2[close] &&
                    candle_1[open] < candle_1[close] &&
                    candle_2[close] - candle_2[open] > (candle_1[close] - candle_1[open]) * 1.5 &&
                    candle_2[high] - candle_2[low] > (candle_1[high] - candle_1[low]) * 1.5 &&
                    candle_2[volume] * 2 < candle_1[volume] &&
                    candle_1[high] < candle_0[high] &&
                    (candle_1[high]- candle_1[low])*100 /candle_1[high] <0.6 &&
                    9<hours < 14 &&
                    pos > 140
                );
                if (DOWNcondition) {
        

                    const EntryPrice = candle_0[close];
                    const StopLossPrice = candle_1[high] + 0.5;
                    const StopLossPoints = Math.abs((StopLossPrice - candle_1[low]).toFixed(2));
                    const TargetPrice = Math.abs((candle_1[low] - (StopLossPoints * 2)).toFixed(2));
                    const TargetPoints = Math.abs((candle_1[low] - TargetPrice).toFixed(2));

                    //1X Quantity
                    const Quantity = Math.floor(Math.abs(MyRiskPerTrade / StopLossPoints));
                    const Loss = Math.abs((StopLossPoints * Quantity).toFixed(2));
                    const Profit = Math.abs((TargetPoints * Quantity).toFixed(2));
                    const requiredMargin = Math.abs((EntryPrice * Quantity / 5).toFixed(2));

                    //2X Quantity
                    const Quantity_2 = Math.floor(Math.abs(MyRiskPerTrade * 2 / StopLossPoints));
                    const Loss_2 = Math.abs((StopLossPoints * Quantity_2).toFixed(2));
                    const Profit_2 = Math.abs((TargetPoints * Quantity_2).toFixed(2));
                    const requiredMargin_2 = Math.abs((EntryPrice * Quantity_2 / 5).toFixed(2));

                    //4X Quantity
                    const Quantity_4 = Math.floor(Math.abs(MyRiskPerTrade * 4 / StopLossPoints));
                    const Loss_4 = Math.abs((StopLossPoints * Quantity_4).toFixed(2));
                    const Profit_4 = Math.abs((TargetPoints * Quantity_4).toFixed(2));
                    const requiredMargin_4 = Math.abs((EntryPrice * Quantity_4 / 5).toFixed(2));

                    //8X Quantity
                    const Quantity_8 = Math.floor(Math.abs(MyRiskPerTrade * 8 / StopLossPoints));
                    const Loss_8 = Math.abs((StopLossPoints * Quantity_8).toFixed(2));
                    const Profit_8 = Math.abs((TargetPoints * Quantity_8).toFixed(2));
                    const requiredMargin_8 = Math.abs((EntryPrice * Quantity_8 / 5).toFixed(2));

                    const DEFAULT_MESSAGE = `Action:Sell, Date:${date}, Time:${Time}, StockName:${nifty50StocksList[Index][1]},
Entry_Price: ${EntryPrice}, Stop_Loss: ${StopLossPrice}, Target_Price: ${TargetPrice}, 
Quantity: ${Quantity}, Loss: ${Loss}, Profit: ${Profit}, Required_Margin: ${requiredMargin}
Quantity_2: ${Quantity_2}, Loss_2: ${Loss_2}, Profit_2: ${Profit_2}, Required_Margin_2: ${requiredMargin_2}
Quantity_4: ${Quantity_4}, Loss_4: ${Loss_4}, Profit_4: ${Profit_4}, Required_Margin_4: ${requiredMargin_4}
Quantity_8: ${Quantity_8}, Loss_8: ${Loss_8}, Profit_8: ${Profit_8}, Required_Margin_8: ${requiredMargin_8}`;

                   

                    const allMessage = JSON.parse(localStorage.getItem('messages')) || [];
                    if (!allMessage.includes(DEFAULT_MESSAGE)) {
                        messages.push(DEFAULT_MESSAGE);
                        sendTelegramMessage(DEFAULT_MESSAGE);
                        console.log("Message sent:", DEFAULT_MESSAGE);
                    } else {
                        // console.log('Message already exists in local storage');
                    }
                } else if (UPcondition) {
                    const EntryPrice = candle_0[close];
                    const StopLossPrice = candle_1[low] - 0.5;
                    const StopLossPoints = Math.abs((candle_1[high] - StopLossPrice).toFixed(2));
                    const TargetPrice = Math.abs((candle_1[high] + (StopLossPoints * 2)).toFixed(2));
                    const TargetPoints = Math.abs((TargetPrice - candle_1[high]).toFixed(2));

                    //1X Quantity
                    const Quantity = Math.floor(Math.abs(MyRiskPerTrade / StopLossPoints));
                    const Loss = Math.abs((StopLossPoints * Quantity).toFixed(2));
                    const Profit = Math.abs((TargetPoints * Quantity).toFixed(2));
                    const requiredMargin = Math.abs((EntryPrice * Quantity / 5).toFixed(2));
                    //2X Quantity
                    const Quantity_2 = Math.floor(Math.abs(MyRiskPerTrade * 2 / StopLossPoints));
                    const Loss_2 = Math.abs((StopLossPoints * Quantity_2).toFixed(2));
                    const Profit_2 = Math.abs((TargetPoints * Quantity_2).toFixed(2));
                    const requiredMargin_2 = Math.abs((EntryPrice * Quantity_2 / 5).toFixed(2));
                    //4X Quantity
                    const Quantity_4 = Math.floor(Math.abs(MyRiskPerTrade * 4 / StopLossPoints));
                    const Loss_4 = Math.abs((StopLossPoints * Quantity_4).toFixed(2));
                    const Profit_4 = Math.abs((TargetPoints * Quantity_4).toFixed(2));
                    const requiredMargin_4 = Math.abs((EntryPrice * Quantity_4 / 5).toFixed(2));
                    //8X Quantity
                    const Quantity_8 = Math.floor(Math.abs(MyRiskPerTrade * 8 / StopLossPoints));
                    const Loss_8 = Math.abs((StopLossPoints * Quantity_8).toFixed(2));
                    const Profit_8 = Math.abs((TargetPoints * Quantity_8).toFixed(2));
                    const requiredMargin_8 = Math.abs((EntryPrice * Quantity_8 / 5).toFixed(2));


                    const DEFAULT_MESSAGE = `Action:Buy, Date:${date}, Time:${Time}, StockName:${nifty50StocksList[Index][1]},
Entry_Price: ${EntryPrice}, Stop_Loss: ${StopLossPrice}, Target_Price: ${TargetPrice}, 
Quantity: ${Quantity}, Loss: ${Loss}, Profit: ${Profit}, Required_Margin: ${requiredMargin}
Quantity_2: ${Quantity_2}, Loss_2: ${Loss_2}, Profit_2: ${Profit_2}, Required_Margin_2: ${requiredMargin_2}
Quantity_4: ${Quantity_4}, Loss_4: ${Loss_4}, Profit_4: ${Profit_4}, Required_Margin_4: ${requiredMargin_4}
Quantity_8: ${Quantity_8}, Loss_8: ${Loss_8}, Profit_8: ${Profit_8}, Required_Margin_8: ${requiredMargin_8}`;
                    const allMessage = JSON.parse(localStorage.getItem('messages')) || [];
                    if (!allMessage.includes(DEFAULT_MESSAGE)) {
                        messages.push(DEFAULT_MESSAGE);
                        sendTelegramMessage(DEFAULT_MESSAGE);
                        console.log("Message sent:", DEFAULT_MESSAGE);
                    } else {
                        // console.log('Message already exists in local storage');
                    }
                }
                CycleRepeat();
            }
        } catch (error) {
            console.log(error);
            CycleRepeat();
        }
    }
};


fetchData()

function CycleRepeat() {
    Index = Index + 1;
    if (Index == nifty50StocksList.length) {
        Index = 0;
    }
}

async function sendTelegramMessage(DEFAULT_MESSAGE) {
    try {
        const response = await fetch(
            `https://api.telegram.org/bot${BOT_TOKEN}/sendMessage?chat_id=${CHAT_ID}&text=${encodeURIComponent(DEFAULT_MESSAGE)}`
        );
        const result = await response.json();
        if (result.ok) {
            localStorage.setItem('messages', JSON.stringify(messages));
            console.log("Message sent:", DEFAULT_MESSAGE);
        } else {
            alert('Error sending message: ' + result.description);
        }
    } catch (error) {
        alert('Error sending message: ' + error.message);
    }
}

async function clearMessages() {
    if (confirm("Are you sure you want to delete all messages?")) {
        localStorage.removeItem('messages');
        messages = [];
        alert('Messages cleared');
    } else {
        alert('Messages not cleared');
    }
}

async function getMessages() {
    const storedMessages = JSON.parse(localStorage.getItem('messages'));
    if (storedMessages && storedMessages.length > 0) {
        console.log('Stored messages:', storedMessages);
    } else {
        alert('No messages found in local storage');
    }
}

function DateTime(inputDateTime) {
    const date = new Date(inputDateTime);
    const day = String(date.getDate()).padStart(2, '0');
    const month = String(date.getMonth() + 1).padStart(2, '0');
    const year = date.getFullYear();
    const hours = String(date.getHours()).padStart(2, '0');
    const minutes = String(date.getMinutes()).padStart(2, '0');
    const formattedOutput = [`${day}-${month}-${year}`, `${hours}:${minutes}`, hours];
    return formattedOutput;
}

const PositiveNegative = async () => {
    let PositiveStock = 0, NegativeStock = 0;
    try {
        const response = await axios.get(
            `https://api.upstox.com/v3/market-quote/ltp?instrument_key=${LTPQuotesStockList}`,
            {
                headers: {
                    'Accept': 'application/json',
                    'Authorization': `Bearer ${Access_Toke}`
                }
            }
        );
        if (response.status === 200) {
            for (const [key, { cp, last_price }] of Object.entries(response.data.data)) {
                if (cp != null && last_price != null) {
                    if (cp > last_price) NegativeStock++;
                    else if (cp < last_price) PositiveStock++;
                }
            }
        }
    } catch (error) {
        console.error('Error fetching stock data:', error);
    }
    return [NegativeStock, PositiveStock];
};

const debounce = (func, wait) => {
    let timeout;
    return (...args) => {
        clearTimeout(timeout);
        timeout = setTimeout(() => func(...args), wait);
    };
};

const FetchNegativePositive = async () => {
    const positiveCount = document.getElementById('positiveCount');
    const negativeCount = document.getElementById('negativeCount');
    const lastUpdated = document.getElementById('lastUpdated');
    const [NegativeStock, PositiveStock] = await PositiveNegative();
    if (PositiveStock !== lastPositive || NegativeStock !== lastNegative) {
        positiveCount.textContent = PositiveStock;
        negativeCount.textContent = NegativeStock;
        lastPositive = PositiveStock;
        lastNegative = NegativeStock;
    }
    const date = new Date();
    const hours = String(date.getHours()).padStart(2, '0');
    const minutes = String(date.getMinutes()).padStart(2, '0');
    const seconds = String(date.getSeconds()).padStart(2, '0');
    lastUpdated.textContent = `Last updated: ${hours}:${minutes}:${seconds}`;
    posiNegTime[0] = NegativeStock;
    posiNegTime[1] = PositiveStock;
    posiNegTime[2] = `${hours}:${minutes}:${seconds}`;
};

const debouncedFetch = debounce(FetchNegativePositive, 200);
setInterval(debouncedFetch, 2000);
FetchNegativePositive();

document.getElementById('sendMessage').addEventListener('click', () => console.log('Send Message button clicked'));
document.getElementById('clearMessages').addEventListener('click', clearMessages);
document.getElementById('getMessages').addEventListener('click', getMessages);
}
    </script>
    
</body>
</html>
